<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Heatmap — amp_heatmap • ampvis2</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>


<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>


<meta property="og:title" content="Heatmap — amp_heatmap" />

<meta property="og:description" content="Generates a heatmap of amplicon data by using sample metadata to aggregate samples and taxonomy to aggregate OTUs." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-93913019-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-93913019-2');
</script>

  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ampvis2</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.4.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/ampvis2.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/faq.html">FAQ</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/MadsAlbertsen/ampvis2">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Heatmap</h1>
    
    <div class="hidden name"><code>amp_heatmap.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Generates a heatmap of amplicon data by using sample metadata to aggregate samples and taxonomy to aggregate OTUs.</p>
    
    </div>

    <pre class="usage"><span class='fu'>amp_heatmap</span>(<span class='no'>data</span>, <span class='kw'>group_by</span> <span class='kw'>=</span> <span class='st'>""</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>(<em>required</em>) Data list as loaded with <code><a href='amp_load.html'>amp_load</a></code>.</p></td>
    </tr>
    <tr>
      <th>group_by</th>
      <td><p>(<em>recommended</em>) Group the samples by a categorical variable in the metadata. If <code>NULL</code> then all samples are shown.</p></td>
    </tr>
    <tr>
      <th>facet_by</th>
      <td><p>Facet the samples by a categorical variable in the metadata.</p></td>
    </tr>
    <tr>
      <th>normalise</th>
      <td><p>(<em>logical</em>) Transform the OTU read counts to be in percent per sample. (<em>default:</em> <code>TRUE</code>)</p></td>
    </tr>
    <tr>
      <th>tax_aggregate</th>
      <td><p>The taxonomic level to aggregate the OTUs. (<em>default:</em> <code>"Phylum"</code>)</p></td>
    </tr>
    <tr>
      <th>tax_add</th>
      <td><p>Additional taxonomic level(s) to display, e.g. <code>"Phylum"</code>. (<em>default:</em> <code>"none"</code>)</p></td>
    </tr>
    <tr>
      <th>tax_show</th>
      <td><p>The number of taxa to show, or a vector of taxa names. (<em>default:</em> <code>10</code>)</p></td>
    </tr>
    <tr>
      <th>tax_class</th>
      <td><p>Converts a specific phylum to class level instead, e.g. <code>"p__Proteobacteria"</code>.</p></td>
    </tr>
    <tr>
      <th>tax_empty</th>
      <td><p>How to show OTUs without taxonomic information. One of the following:</p><ul>
<li><p><code>"remove"</code>: Remove OTUs without taxonomic information.</p></li>
<li><p><code>"best"</code>: (<em>default</em>) Use the best classification possible.</p></li>
<li><p><code>"OTU"</code>: Display the OTU name.</p></li>
</ul></td>
    </tr>
    <tr>
      <th>order_x_by</th>
      <td><p>A sample or vector to order the y-axis by, or <code>"cluster"</code> for hierarchical clustering by <code><a href='http://www.rdocumentation.org/packages/stats/topics/hclust'>hclust</a></code>.</p></td>
    </tr>
    <tr>
      <th>order_y_by</th>
      <td><p>A taxonomy group or vector to order the x-axis by, or <code>"cluster"</code> for hierarchical clustering by <code><a href='http://www.rdocumentation.org/packages/stats/topics/hclust'>hclust</a></code>.</p></td>
    </tr>
    <tr>
      <th>plot_values</th>
      <td><p>(<em>logical</em>) Plot the values on the heatmap or not. (<em>default:</em> <code>TRUE</code>)</p></td>
    </tr>
    <tr>
      <th>plot_values_size</th>
      <td><p>The size of the plotted values. (<em>default:</em> <code>4</code>)</p></td>
    </tr>
    <tr>
      <th>plot_legendbreaks</th>
      <td><p>A vector of breaks for the abundance legend, fx <code>c(1, 10, 20)</code>.</p></td>
    </tr>
    <tr>
      <th>plot_colorscale</th>
      <td><p>The type of scale used for the coloring of abundances, either <code>"sqrt"</code> or <code>"log10"</code>. (<em>default:</em> <code>"log10"</code>)</p></td>
    </tr>
    <tr>
      <th>plot_na</th>
      <td><p>(<em>logical</em>) Whether to color missing values with the lowest color in the scale or not. (<em>default:</em> <code>TRUE</code>)</p></td>
    </tr>
    <tr>
      <th>measure</th>
      <td><p>Calculate and display either <code>"mean"</code>, <code>"max"</code> or <code>"median"</code> across the groups. (<em>default:</em> <code>"mean"</code>)</p></td>
    </tr>
    <tr>
      <th>min_abundance</th>
      <td><p>All values below this value are given the same color. (<em>default:</em> <code>0.1</code>)</p></td>
    </tr>
    <tr>
      <th>max_abundance</th>
      <td><p>All values above this value are given the same color.</p></td>
    </tr>
    <tr>
      <th>sort_by</th>
      <td><p>Sort the heatmap by a specific value of the <code>"group_by"</code> argument, e.g. <code>"Treatment A"</code>.</p></td>
    </tr>
    <tr>
      <th>normalise_by</th>
      <td><p>A variable or a specific sample in the metadata to normalise the counts by.</p></td>
    </tr>
    <tr>
      <th>scale_by</th>
      <td><p>Scale the abundances by a variable in the metadata.</p></td>
    </tr>
    <tr>
      <th>color_vector</th>
      <td><p>Vector of colors for the colorscale, e.g. <code>c("white", "red")</code>.</p></td>
    </tr>
    <tr>
      <th>round</th>
      <td><p>Number of digits to show with the values. (<em>default:</em> <code>1</code>)</p></td>
    </tr>
    <tr>
      <th>textmap</th>
      <td><p>(<em>logical</em>) Return a data frame to print as raw text instead of a ggplot2 object. (<em>default:</em> <code>FALSE</code>)</p></td>
    </tr>
    <tr>
      <th>plot_functions</th>
      <td><p>Return a 2-column grid plot instead, showing known functional information about the Genus-level OTUs next to the heatmap. When using this feature, make sure that either <code>tax_aggregate</code> is set to "Genus" or that <code>tax_add</code> contains "Genus". (<em>default:</em> <code>FALSE</code>)</p></td>
    </tr>
    <tr>
      <th>function_data</th>
      <td><p>If <code>plot_functions</code> is set to <code>TRUE</code>: A data frame with functional information about genus-level OTUs in each column. If <code>NULL</code> the <code>data("MiF")</code> dataset will be used. (<em>default:</em> <code>NULL</code>)</p></td>
    </tr>
    <tr>
      <th>functions</th>
      <td><p>If <code>plot_functions</code> is set to <code>TRUE</code>: A vector with the functions to be displayed. (<em>default:</em> <code>c("MiDAS","FIL", "AOB", "NOB", "PAO", "GAO")</code>)</p></td>
    </tr>
    <tr>
      <th>rel_widths</th>
      <td><p>If <code>plot_functions</code> is set to <code>TRUE</code>: A vector with the relative widths of the heatmap and function grid when <code>plot_functions = TRUE</code>. (<em>default:</em> <code>c(0.75, 0.25)</code>)</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A ggplot2 object, or a data frame if <code>textmap = TRUE</code>.</p>
    
    <h2 class="hasAnchor" id="preserving-relative-abundances-in-a-subset-of-larger-data"><a class="anchor" href="#preserving-relative-abundances-in-a-subset-of-larger-data"></a>Preserving relative abundances in a subset of larger data</h2>

    
    <p>By default the raw read counts in the abundance matrix are normalised (transformed to percentages) by some plotting functions automatically (for example <code>amp_heatmap</code>, <code><a href='amp_timeseries.html'>amp_timeseries</a></code>, and more). This means that the relative abundances shown will be calculated based on the remaining taxa after the subset, not including the removed taxa, if any. To circumvent this, set <code>normalise = TRUE</code> when subsetting with the <code><a href='amp_subset_taxa.html'>amp_subset_taxa</a></code> and <code><a href='amp_subset_samples.html'>amp_subset_samples</a></code> functions, and then set <code>normalise = FALSE</code> in the plotting function. This will transform the OTU counts to relative abundances BEFORE the subset, and setting <code>normalise = FALSE</code> will skip the transformation in the plotting function, see the example below.</p>
<pre>
data("MiDAS")
subsettedData &lt;- amp_subset_samples(MiDAS,
                                    Plant %in% c("Aalborg West", "Aalborg East"),
                                    normalise = TRUE
                                    )
amp_heatmap(subsettedData,
            group_by = "Plant",
            tax_aggregate = "Phylum",
            tax_add = "Genus",
            normalise = FALSE
            )
</pre>
    
    <h2 class="hasAnchor" id="accessing-detailed-raw-data"><a class="anchor" href="#accessing-detailed-raw-data"></a>Accessing detailed raw data</h2>

    
    <p>The complete raw data used to generate any ggplot can always be accessed with <code>ggplot2_object$data</code> when the plot is saved as a ggplot2 object. Additionally, a "textmap" version of the generated heatmap can also be generated by setting <code>textmap = TRUE</code> to only extract the raw data as shown on the particular heatmap, see examples.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='amp_load.html'>amp_load</a></code></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Load example data</span>
<span class='fu'>data</span>(<span class='st'>"AalborgWWTPs"</span>)

<span class='co'># Heatmap grouped by WWTP</span>
<span class='fu'>amp_heatmap</span>(<span class='no'>AalborgWWTPs</span>, <span class='kw'>group_by</span> <span class='kw'>=</span> <span class='st'>"Plant"</span>)</div><div class='img'><img src='amp_heatmap-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Heatmap of 20 most abundant Genera (by mean) grouped by WWTP, split by Year,</span>
<span class='co'># values not plotted for visibility, phylum name added and colorscale adjusted manually</span>
<span class='fu'>amp_heatmap</span>(<span class='no'>AalborgWWTPs</span>,
  <span class='kw'>group_by</span> <span class='kw'>=</span> <span class='st'>"Plant"</span>,
  <span class='kw'>facet_by</span> <span class='kw'>=</span> <span class='st'>"Year"</span>,
  <span class='kw'>plot_values</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>tax_show</span> <span class='kw'>=</span> <span class='fl'>20</span>,
  <span class='kw'>tax_aggregate</span> <span class='kw'>=</span> <span class='st'>"Genus"</span>,
  <span class='kw'>tax_add</span> <span class='kw'>=</span> <span class='st'>"Phylum"</span>,
  <span class='kw'>color_vector</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"white"</span>, <span class='st'>"red"</span>),
  <span class='kw'>plot_colorscale</span> <span class='kw'>=</span> <span class='st'>"sqrt"</span>,
  <span class='kw'>plot_legendbreaks</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>1</span>, <span class='fl'>5</span>, <span class='fl'>10</span>)
)</div><div class='img'><img src='amp_heatmap-2.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Heatmap with known functional information about the Genera shown to the right</span>
<span class='fu'>amp_heatmap</span>(<span class='no'>AalborgWWTPs</span>,
  <span class='kw'>group_by</span> <span class='kw'>=</span> <span class='st'>"Plant"</span>,
  <span class='kw'>tax_aggregate</span> <span class='kw'>=</span> <span class='st'>"Genus"</span>,
  <span class='kw'>plot_functions</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>functions</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"PAO"</span>, <span class='st'>"GAO"</span>, <span class='st'>"AOB"</span>, <span class='st'>"NOB"</span>)
)</div><div class='img'><img src='amp_heatmap-3.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># A raw text version of the heatmap can be printed or saved as a data frame with textmap = TRUE:</span>
<span class='no'>textmap</span> <span class='kw'>&lt;-</span> <span class='fu'>amp_heatmap</span>(<span class='no'>AalborgWWTPs</span>,
  <span class='kw'>group_by</span> <span class='kw'>=</span> <span class='st'>"Plant"</span>,
  <span class='kw'>tax_aggregate</span> <span class='kw'>=</span> <span class='st'>"Genus"</span>,
  <span class='kw'>plot_functions</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>functions</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"PAO"</span>, <span class='st'>"GAO"</span>, <span class='st'>"AOB"</span>, <span class='st'>"NOB"</span>),
  <span class='kw'>textmap</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>
)
<span class='no'>textmap</span></div><div class='output co'>#&gt;                          Aalborg East Aalborg West PAO GAO AOB NOB
#&gt; Tetrasphaera                 5.478941     6.842382 POS NEG NEG NEG
#&gt; Trichococcus                 7.098638     3.028602  NT  NT  NT  NT
#&gt; Candidatus Microthrix        2.769444     6.503052 NEG NEG NEG NEG
#&gt; Rhodoferax                   3.361297     2.403885 NEG  NT  NT  NT
#&gt; Rhodobacter                  1.847766     2.967430  NT  NT  NT  NT
#&gt; Candidatus Promineofilum     1.317348     3.028949 NEG NEG NEG NEG
#&gt; Dechloromonas                1.220824     2.503898 VAR NEG  NT  NT
#&gt; Candidatus Defluviifilum     1.824867     1.502981 NEG NEG NEG NEG
#&gt; Propionicimonas              1.229790     1.726184  NT  NT  NT  NT
#&gt; Fodinibacter                 1.382478     1.530972  NT  NT  NT  NT</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#preserving-relative-abundances-in-a-subset-of-larger-data">Preserving relative abundances in a subset of larger data</a></li>

      <li><a href="#accessing-detailed-raw-data">Accessing detailed raw data</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
Kasper Skytte Andersen <a href='mailto:kasperskytteandersen@gmail.com'>kasperskytteandersen@gmail.com</a>

Mads Albertsen <a href='mailto:MadsAlbertsen85@gmail.com'>MadsAlbertsen85@gmail.com</a>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Mads Albertsen, Kasper Skytte Andersen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script>
  docsearch({
    
    
    apiKey: 'b0ba3a3eb751685982ccf010113f380a',
    indexName: 'ampvis2',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>


  </body>
</html>

